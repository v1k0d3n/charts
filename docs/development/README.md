# Development Guide

This document explains how to contribute to and maintain the Helm charts repository.

## Repository Structure

```
charts/                   # Generated chart packages (DO NOT EDIT)
├── index.yaml            # Auto-generated repository index
└── chart-name/           # Chart packages
sources/                  # Chart source configurations (EDIT THESE)
├── chart-name.yaml       # Source configuration for each chart
.github/workflows/        # GitHub Actions workflows
├── publish.yml           # Automatic chart publishing
├── update-chart.yml      # Manual chart updates
└── pages.yml             # GitHub Pages deployment
scripts/                  # Helper scripts
├── add-git-chart.sh      # Add charts from git repositories
└── demo.sh               # Demonstration workflow
Makefile                  # Build and management commands
```

## Safe Contribution Guidelines

### ✅ **Safe to Edit:**
- `sources/` - Chart source configurations
- `docs/` - Documentation
- `scripts/` - Helper scripts
- `Makefile` - Build commands
- `.github/workflows/` - GitHub Actions
- `README.md` - Project documentation

### ❌ **Never Edit:**
- `charts/` - Generated by GitHub Actions
- Any `.tgz` files - Chart packages
- `charts/index.yaml` - Auto-generated index

## Adding New Charts

### Option 1: From Git Repository

```bash
# Use the helper script
./scripts/add-git-chart.sh my-chart https://github.com/user/repo helm/ v1.0.0

# Or manually create sources/my-chart.yaml
```

Example `sources/my-chart.yaml`:
```yaml
# my-chart source configuration
repo_url: https://github.com/user/repo
chart_path: helm/
ref: v1.0.0
```

### Option 2: From Helm Repository

```bash
# Use make command
make add-chart CHART=my-chart REPO=https://quay.io/user/charts PATH=my-chart VERSION=1.0.0
```

Example `sources/my-chart.yaml`:
```yaml
# my-chart source configuration
repo_url: https://quay.io/user/charts
chart_path: my-chart
version: 1.0.0
```

## Updating Charts

### Automatic Updates
Charts are automatically updated:
- On every push to main branch
- Weekly on Sundays at 2 AM UTC

### Manual Updates
1. **Edit source configuration** in `sources/chart-name.yaml`
2. **Commit and push** the change
3. **GitHub Actions** will automatically update the chart

### Manual Workflow Trigger
1. Go to GitHub → Actions → "Update Specific Chart"
2. Enter chart name and optional version
3. Click "Run workflow"

## Local Development

### Testing Chart Packaging
```bash
# Initialize repository structure
make init

# Update all charts locally
make update-charts

# Update specific chart
make update-chart CHART=chart-name

# View available chart versions
make versions

# Test repository
make test

# Clean up temporary files
make clean
```

### Testing Chart Installation
```bash
# Add your local repository
helm repo add local-test file://$(pwd)/charts

# Search for charts
helm search repo local-test --devel

# Test installation
helm install test-chart local-test/chart-name --dry-run
```

## GitHub Actions Workflows

### `publish.yml`
- **Triggers**: Push to main, weekly schedule, manual
- **Purpose**: Update all charts and publish to GitHub Pages
- **Output**: Updated charts in `charts/` directory

### `update-chart.yml`
- **Triggers**: Manual workflow dispatch
- **Purpose**: Update specific chart with optional version
- **Inputs**: Chart name, version (optional)

### `pages.yml`
- **Triggers**: Push to main, manual
- **Purpose**: Deploy charts to GitHub Pages
- **Output**: Charts available at `https://v1k0d3n.github.io/charts`

## Troubleshooting

### Chart Not Appearing in Search
- Check if version is pre-release (use `--devel` flag)
- Verify source configuration is correct
- Check GitHub Actions workflow status

### GitHub Actions Failures
- Ensure GitHub Pages is enabled
- Check workflow logs for specific errors
- Verify source repository accessibility

### Local Build Issues
- Run `make clean` to remove temporary files
- Check source configuration syntax
- Verify git repository accessibility

## Best Practices

1. **Version Pinning**: Always pin specific versions for stability
2. **Source Tracking**: Use source configurations to track chart origins
3. **Documentation**: Keep README.md updated with available charts
4. **Testing**: Test charts locally before pushing changes
5. **Automation**: Let GitHub Actions handle chart packaging

## Contributing

1. Fork the repository
2. Create a feature branch
3. Add or update source configurations
4. Test locally with `make test`
5. Commit and push changes
6. Submit a pull request

## License

Apache License 2.0 - see [LICENSE](../../LICENSE) file for details.
